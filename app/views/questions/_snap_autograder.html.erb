<% content_for :head do %>
  <!-- NOTE: jQuery and _ are included in the Rails App  -->

  <!-- AG Snap Modifications -->
  <script src="/snap-path.js"></script>
  <script src="/autograder/ag-files/snap-ui-overrides.js"></script>

  <!-- Autograder custom display -->
  <link rel="stylesheet" type="text/css" href="/autograder/ag-files/AG_status_bar.css" />
  <link rel="stylesheet" type="text/css" href="/autograder/ag-files/hintstyle.css" />

  <!-- Main autograder components -->
  <script src='/autograder/ag-files/ag-util.js'></script>
  <script src='/autograder/ag-files/spriteEventLog.js'></script>
  <script src='/autograder/ag-files/scriptAnalysis.js'></script>
  <script src="/autograder/ag-files/AGAgent.js"></script>
  <script src='/autograder/ag-files/feedbackLog.js'></script>
  <script src="/autograder/ag-files/AGFormatting.js"></script>

  <!-- Custom cloud access on localhost only. -->
  <% if Rails.env == 'development' %>
  <script src="/autograder/ag-files/snap-local-cloud.js"></script>
  <% end %>

  <!-- Load snap + AG additions, similar to snap.html -->
  <script>
  function RESET_WORLD_SIZE() {
    // The canvas size needs to manually be set so that morphic
    // knows the exact pixel dimensions to handle.
    var jQworld, agHeight, snap;
    jQworld = $('#world');
    snap = $('#snap');
    agHeight = $('#ag-header').height();
    // $(document.body).style('height', $(window).height());
    // $(document.body).style('overflow-y', 'hidden');
    jQworld.attr('height', $(window).height() - agHeight - 10);
    jQworld.attr('width', snap.width());
    jQworld.css('top', agHeight);
    jQworld.css('width', '100%');
    snap.css('top', agHeight);
    if (world) {
        world.changed();
      world.drawNew();
    }
  }
  // THIS SEEMS LIKE A HACK.
  // but this site is not edX....
  isEDX = false;
  var world, world_canvas;
  window.onload = function () {
    RESET_WORLD_SIZE();
    $(window).on('resize', RESET_WORLD_SIZE);
    var ide, grade_button;
    world_canvas = document.getElementById('world')
    world = new WorldMorph(world_canvas, false); // do not autosize
    (new IDE_Morph()).openIn(world);
    // Start Snap Environment Loop
    loop();

    // AUTOGRADER ADDITIONS:
    // Initialize AGSB button.
    $("#autograding_button").click(doExecAndDisplayTests);
    world_canvas.addEventListener("mouseup", update_listener);
    // This is a link relative to /problems/N/
    starter_path = gon.starter_file_path;
    initializeSnapAdditions(world, id);
  };

  function loop() {
    requestAnimationFrame(loop);
    world.doOneCycle();
  }
  </script>
<% end %>
